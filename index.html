<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>길음한의원 인지 건강 종합 검사지</title>
    <style>
        body { font-family: 'Malgun Gothic', '맑은 고딕', sans-serif; background-color: #f8f9fa; color: #333; line-height: 1.6; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background-color: #ffffff; padding: 30px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1, h2 { text-align: center; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-bottom: 30px; }
        h3.section-subtitle { font-size: 1.2em; color: #555; text-align: left; border-bottom: 1px dotted #ccc; padding-bottom: 5px; margin-top: 25px; margin-bottom: 15px; }
        .section { margin-bottom: 35px; }
        .section-title { font-size: 1.4em; font-weight: bold; color: #3498db; margin-bottom: 15px; }
        .question { margin-bottom: 20px; }
        .question p { font-size: 1.1em; margin: 0 0 10px 0; }
        .input-group { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 10px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        label .required { color: #e74c3c; font-weight: bold; margin-left: 4px; }
        input[type="text"], input[type="date"], input[type="number"], select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .radio-group label, .checkbox-group label { font-weight: normal; margin-right: 15px;}
        .select-group select { padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
        #bmi-result { font-weight: bold; color: #e74c3c; margin-left: 10px; }
        .button-container { text-align: center; margin-top: 40px; }
        button { background-color: #3498db; color: white; padding: 15px 30px; border: none; border-radius: 5px; font-size: 1.2em; cursor: pointer; }
        #result-page { display: none; }
        .result-header { text-align: center; margin-bottom: 30px; }
        .result-header h1 { font-size: 2em; color: #3498db; border: none;}
        .patient-info { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; border: 1px solid #eee; padding: 15px; margin-bottom: 30px; border-radius: 5px; text-align: center; font-size: 1.1em; }
        .result-box { padding: 25px; margin: 20px 0; border-radius: 8px; text-align: center; }
        .result-box.level-1 { background-color: #e8f5e9; border: 2px solid #4caf50; }
        .result-box.level-2 { background-color: #fffde7; border: 2px solid #ffc107; }
        .result-box.level-3 { background-color: #ffebee; border: 2px solid #f44336; }
        .result-box .result-title { font-size: 2.2em; font-weight: bold; margin: 0; }
        .result-box .result-subtitle { font-size: 1.2em; margin: 5px 0 0 0;}
        .result-section { margin-top: 30px; }
        .result-section h3 { font-size: 1.3em; color: #3498db; border-bottom: 1px solid #eee; padding-bottom: 8px;}
        .result-section ul { list-style-type: '✓ '; padding-left: 20px;}
        .result-section li { margin-bottom: 8px; }
        .practitioner-comment { margin-top: 40px; padding: 15px; border: 1px dashed #ccc; border-radius: 5px; }
        .practitioner-comment h3 { margin-top: 0;}
        @media print { body { background-color: white; padding: 0; } #cognitive-form, .no-print { display: none !important; } #result-page { display: block !important; box-shadow: none; border: none; padding: 0; margin: 0; } .container { padding: 0; box-shadow: none; border-radius: 0; } }
    </style>
</head>
<body>
    <div class="container">
        <form id="cognitive-form">
            <h1>인지 건강 종합 검사지</h1>

            <div class="section">
                <h2 class="section-title">1. 기본 정보</h2>
                <div class="input-group">
                    <div><label for="name">성함<span class="required">*</span></label><input type="text" id="name" name="name"></div>
                    <div><label for="birthdate">생년월일<span class="required">*</span></label><input type="date" id="birthdate" name="birthdate"></div>
                </div>
                <div class="input-group">
                    <div><label for="gender">성별<span class="required">*</span></label><select id="gender" name="gender"><option value="">선택</option><option value="male">남</option><option value="female">여</option></select></div>
                    <div><label for="today">검사 날짜</label><input type="date" id="today" name="today"></div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">2. 인지 기능 종합 평가</h2>
                <h3 class="section-subtitle">2-1. 기억력</h3>
                <div class="question"><p>1. 최근 기억력이 예전 같지 않다고 느끼십니까?<span class="required">*</span></p><div class="radio-group"><label><input type="radio" name="q1" value="1">전혀</label><label><input type="radio" name="q1" value="2">가끔</label><label><input type="radio" name="q1" value="3">자주</label><label><input type="radio" name="q1" value="4">항상</label></div></div>
                <div class="question"><p>2. 며칠 전 대화나 약속을 잊어버립니까?<span class="required">*</span></p><div class="radio-group"><label><input type="radio" name="q2" value="1">전혀</label><label><input type="radio" name="q2" value="2">가끔</label><label><input type="radio" name="q2" value="3">자주</label><label><input type="radio" name="q2" value="4">항상</label></div></div>
                <div class="question"><p>3. 물건 둔 곳을 몰라 한참 찾습니까?<span class="required">*</span></p><div class="radio-group"><label><input type="radio" name="q3" value="1">거의</label><label><input type="radio" name="q3" value="2">가끔</label><label><input type="radio" name="q3" value="3">자주</label><label><input type="radio" name="q3" value="4">매우 자주</label></div></div>
                <div class="question"><p>4. 대화 중 단어가 잘 안 떠오릅니까?<span class="required">*</span></p><div class="radio-group"><label><input type="radio" name="q4" value="1">거의</label><label><input type="radio" name="q4" value="2">가끔</label><label><input type="radio" name="q4" value="3">자주</label><label><input type="radio" name="q4" value="4">매우 자주</label></div></div>
                <h3 class="section-subtitle">2-2. 실행 및 판단 능력</h3>
                <div class="question"><p>5. 여러 일을 순서대로 처리(요리, 약 챙기기)가 힘들어졌습니까?<span class="required">*</span></p><div class="radio-group"><label><input type="radio" name="q5" value="1">전혀</label><label><input type="radio" name="q5" value="2">조금 더딤</label><label><input type="radio" name="q5" value="3">도움 필요</label><label><input type="radio" name="q5" value="4">거의 불가능</label></div></div>
                <div class="question"><p>6. 자주 다니던 길에서 방향을 잃거나 헷갈린 적이 있습니까?<span class="required">*</span></p><div class="radio-group"><label><input type="radio" name="q6" value="1">전혀</label><label><input type="radio" name="q6" value="2">가끔 헷갈림</label><label><input type="radio" name="q6" value="3">자주 길 잃음</label><label><input type="radio" name="q6" value="4">혼자 외출 두려움</label></div></div>
            </div>

            <div class="section">
                <h2 class="section-title">3. 정서 및 성격 변화</h2>
                <div class="question"><p>7. 예전 즐기던 취미(TV, 친구 만나기 등)에 흥미가 줄었습니까?</p><div class="radio-group"><label><input type="radio" name="q7" value="1">여전히 즐김</label><label><input type="radio" name="q7" value="2">예전만 못함</label><label><input type="radio" name="q7" value="3">흥미 없음</label><label><input type="radio" name="q7" value="4">만사 귀찮음</label></div></div>
                <div class="question"><p>8. 사소한 일에 화나 짜증이 늘고 성격이 급해졌다는 말을 듣습니까?</p><div class="radio-group"><label><input type="radio" name="q8" value="1">전혀</label><label><input type="radio" name="q8" value="2">가끔</label><label><input type="radio" name="q8" value="3">자주</label><label><input type="radio" name="q8" value="4">매우 자주</label></div></div>
            </div>

            <div class="section">
                <h2 class="section-title">4. 일상생활 수행능력 (IADL)</h2>
                <div class="question"><p>9. 최근 한 달간 다음 활동을 혼자 하는 데 어려움이 있었습니까?<span class="required">*</span></p>
                    <div class="select-group" style="display: grid; grid-template-columns: auto 1fr; align-items: center; gap: 10px 20px;">
                        <label>전화 통화하기:</label> <select name="q9_1"><option value="1">어려움 없음</option><option value="2">조금 어려움</option><option value="3">많은 도움 필요</option></select>
                        <label>금전 관리하기:</label> <select name="q9_2"><option value="1">어려움 없음</option><option value="2">조금 어려움</option><option value="3">많은 도움 필요</option></select>
                        <label>대중교통 이용:</label> <select name="q9_3"><option value="1">어려움 없음</option><option value="2">조금 어려움</option><option value="3">많은 도움 필요</option></select>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">5. 전신 증상 및 생활 습관</h2>
                <div class="question"><p>10. 소화 상태는 어떻습니까? (식후 더부룩함, 소화불량 등)</p><div class="radio-group"><label><input type="radio" name="q10" value="1">좋음</label><label><input type="radio" name="q10" value="2">보통</label><label><input type="radio" name="q10" value="3">가끔 안좋음</label><label><input type="radio" name="q10" value="4">항상 안좋음</label></div></div>
                <div class="question"><p>11. 어지럼증(특히 앉았다 일어설 때)이나 머리가 무거운 느낌이 있습니까?</p><div class="radio-group"><label><input type="radio" name="q11" value="1">거의 없음</label><label><input type="radio" name="q11" value="2">가끔</label><label><input type="radio" name="q11" value="3">자주</label><label><input type="radio" name="q11" value="4">심함</label></div></div>
                <div class="question"><p>12. 소변을 자주 보거나(특히 야간뇨), 개운치 않은 느낌이 있습니까?</p><div class="radio-group"><label><input type="radio" name="q12" value="1">문제 없음</label><label><input type="radio" name="q12" value="2">조금 불편</label><label><input type="radio" name="q12" value="3">자주 불편</label><label><input type="radio" name="q12" value="4">매우 불편</label></div></div>
                <div class="question"><p>13. 수면 상태는 어떻습니까? (잠들기, 중간에 깨는 것, 아침 컨디션)</p><div class="radio-group"><label><input type="radio" name="q13" value="1">매우 좋음</label><label><input type="radio" name="q13" value="2">괜찮은 편</label><label><input type="radio" name="q13" value="3">나쁜 편</label><label><input type="radio" name="q13" value="4">매우 나쁨</label></div></div>
                <div class="question"><p>14. 진단받은 질환이 있다면 모두 선택해 주세요.</p><div class="checkbox-group" style="display:grid; grid-template-columns: 1fr 1fr; gap: 5px;"><label><input type="checkbox" name="q14" value="고혈압">고혈압</label><label><input type="checkbox" name="q14" value="당뇨병">당뇨병</label><label><input type="checkbox" name="q14" value="고지혈증">고지혈증</label><label><input type="checkbox" name="q14" value="심장질환">심장질환</label><label><input type="checkbox" name="q14" value="뇌졸중">뇌졸중</label></div></div>
                <div class="question"><p>15. 신체 계측 및 청력</p><div class="input-group"><div><label for="height">키(cm)</label><input type="number" id="height" name="height"></div><div><label for="weight">몸무게(kg)</label><input type="number" id="weight" name="weight"></div></div><div><label>체질량지수(BMI):</label><span id="bmi-result">키와 몸무게를 입력하세요.</span></div><div style="margin-top:10px;"><label>청력 저하를 느끼십니까?</label><div class="radio-group"><label><input type="radio" name="q15_hearing" value="1">문제없음</label><label><input type="radio" name="q15_hearing" value="2">조금 불편</label><label><input type="radio" name="q15_hearing" value="3">대화 어려움</label></div></div></div>
            </div>

            <div class="button-container"><button type="button" id="submit-btn">결과 분석 및 결과지 생성</button></div>
        </form>

        <div id="result-page">
             <div class="result-header"><h1>길음한의원 인지 건강 종합 결과지</h1></div>
            <div class="patient-info">
                <div><strong>환자성명:</strong> <span id="result-name"></span></div>
                <div><strong>나이:</strong> 만 <span id="result-age"></span>세</div>
                <div><strong>검사일:</strong> <span id="result-date"></span></div>
            </div>
            <div id="result-level-box"></div>
            <div class="result-section"><h3>한의학적 위험 요인 및 변증 분석</h3><ul id="risk-factors-list"></ul></div>
            <div class="practitioner-comment"><h3>김덕호 원장님 종합 소견</h3><p>위 결과는 환자분의 주관적 응답을 바탕으로 한 선별 검사 결과이며 질병의 진단이 아닙니다. <br>인지 기능 저하 및 치매는 조기 발견과 예방적 관리가 매우 중요합니다. 본원에서는 환자분의 체질과 전반적인 건강 상태를 고려한 맞춤형 치료를 통해 뇌 건강을 증진시켜 드립니다.</p><textarea rows="4" style="width: 100%; padding: 10px; font-size: 1em;" placeholder="여기에 추가 소견을 입력하세요..."></textarea></div>
            <div class="button-container no-print"><button onclick="window.print()" style="margin-right: 15px; background-color: #27ae60;">🖨️ 결과지 인쇄하기</button><button onclick="location.reload()">↩️ 새 설문 작성하기</button></div>
        </div>
    </div>

    <script>
        document.getElementById('today').valueAsDate = new Date();
        const heightInput = document.getElementById('height');
        const weightInput = document.getElementById('weight');
        const bmiResult = document.getElementById('bmi-result');
        function calculateBmi() {
            const height = parseFloat(heightInput.value);
            const weight = parseFloat(weightInput.value);
            if (height > 0 && weight > 0) {
                const bmi = weight / ((height / 100) ** 2);
                const bmiValue = bmi.toFixed(2);
                let bmiCategory = bmi < 18.5 ? ' (저체중)' : bmi < 23 ? ' (정상)' : bmi < 25 ? ' (과체중)' : ' (비만)';
                bmiResult.textContent = `${bmiValue} ${bmiCategory}`;
                bmiResult.dataset.bmi = bmi;
            } else { bmiResult.textContent = '키와 몸무게를 입력하세요.'; }
        }
        heightInput.addEventListener('input', calculateBmi);
        weightInput.addEventListener('input', calculateBmi);
        
        document.getElementById('submit-btn').addEventListener('click', function() {
            const form = document.getElementById('cognitive-form');
            const errors = [];
            if (!form.elements['name'].value) errors.push('1부: 환자 성명을 입력해주세요.');
            if (!form.elements['birthdate'].value) errors.push('1부: 생년월일을 입력해주세요.');
            if (!form.elements['gender'].value) errors.push('1부: 성별을 선택해주세요.');
            for (let i = 1; i <= 6; i++) {
                if (!form.querySelector(`input[name="q${i}"]:checked`)) errors.push(`2부 인지 기능 평가: ${i}번 문항에 답변해주세요.`);
            }
            if (!form.elements['q9_1'].value || !form.elements['q9_2'].value || !form.elements['q9_3'].value) {
                errors.push('4부: 일상생활 수행능력 3가지 항목을 모두 선택해주세요.');
            }
            if (errors.length > 0) {
                alert('다음 항목을 확인해주세요:\n\n- ' + errors.join('\n- '));
                return;
            }

            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            data.q14 = formData.getAll('q14');

            let cognitiveScore = 0;
            for (let i = 1; i <= 6; i++) cognitiveScore += parseInt(data[`q${i}`], 10);
            
            let iadlScore = parseInt(data.q9_1) + parseInt(data.q9_2) + parseInt(data.q9_3);

            const riskFactors = [];
            if (data.q7 && parseInt(data.q7) >= 3) riskFactors.push("정서 문제 (간기울결/기허): 의욕 저하 및 무감동은 인지 기능 저하와 밀접한 관련이 있습니다.");
            if (data.q8 && parseInt(data.q8) >= 3) riskFactors.push("성격 변화 (음허화동/간양상항): 쉽게 화를 내는 것은 뇌 혈관 건강에 악영향을 줄 수 있습니다.");
            if (data.q10 && parseInt(data.q10) >= 3) riskFactors.push("소화기 문제 (비허습담): 소화 기능 저하는 뇌를 탁하게 하는 습담(濕痰)을 유발할 수 있습니다.");
            if (data.q11 && parseInt(data.q11) >= 3) riskFactors.push("어지럼증 (담탁/혈허): 뇌 혈액순환 저하의 신호일 수 있습니다.");
            if (data.q12 && parseInt(data.q12) >= 3) riskFactors.push("비뇨기 문제 (신허): 신(腎) 기능의 저하는 뇌수(腦髓) 부족과 직결됩니다.");
            if (data.q13 && parseInt(data.q13) >= 3) riskFactors.push("수면의 질 저하: 뇌가 회복하고 노폐물을 청소할 시간을 충분히 갖지 못하고 있습니다.");
            if (data.q14.length > 0) riskFactors.push(`만성 질환 (${data.q14.join(', ')}): 혈액을 탁하게 하는 어혈(瘀血)의 원인이 됩니다.`);
            const bmi = parseFloat(bmiResult.dataset.bmi);
            if (bmi >= 23) riskFactors.push(`과체중/비만 (BMI: ${bmi.toFixed(2)}): 체내 습담을 조장하여 기혈 순환을 방해합니다.`);
            if (data.q15_hearing && parseInt(data.q15_hearing) >= 3) riskFactors.push("청력 저하: 외부 자극 감소는 인지 활동 저하로 이어집니다.");
            
            let finalLevel = 1;
            if (iadlScore >= 5 || cognitiveScore >= 16 || (cognitiveScore >= 13 && riskFactors.length >= 3)) {
                finalLevel = 3;
            } else if (cognitiveScore >= 9 || riskFactors.length >= 2) {
                finalLevel = 2;
            }

            const birthDate = new Date(data.birthdate);
            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) age--;
            document.getElementById('result-name').textContent = data.name;
            document.getElementById('result-age').textContent = age;
            document.getElementById('result-date').textContent = new Date(data.today).toLocaleDateString('ko-KR');

            const levelBox = document.getElementById('result-level-box');
            if(finalLevel === 1) {
                levelBox.className = 'result-box level-1';
                levelBox.innerHTML = '<div class="result-title">🟢 양호 (초록불)</div><div class="result-subtitle">인지 기능 및 생활 습관이 비교적 건강하게 유지되고 있습니다.</div>';
            } else if (finalLevel === 2) {
                levelBox.className = 'result-box level-2';
                levelBox.innerHTML = '<div class="result-title">🟡 주의 (노란불)</div><div class="result-subtitle">경미한 인지 저하 또는 관련 위험요인이 발견되었습니다. 예방적 관리가 필요합니다.</div>';
            } else {
                levelBox.className = 'result-box level-3';
                levelBox.innerHTML = '<div class="result-title">🔴 경고 (빨간불)</div><div class="result-subtitle">인지 기능 저하 및 일상생활의 어려움이 의심됩니다. 적극적인 검사와 치료를 권장합니다.</div>';
            }

            const riskList = document.getElementById('risk-factors-list');
            riskList.innerHTML = '';
            if (riskFactors.length > 0) {
                riskFactors.forEach(factor => {
                    const li = document.createElement('li');
                    li.textContent = factor;
                    riskList.appendChild(li);
                });
            } else {
                riskList.innerHTML = '<li>특별히 발견된 위험 요인이 없습니다. 좋은 습관을 유지해주세요.</li>';
            }

            document.getElementById('cognitive-form').style.display = 'none';
            document.getElementById('result-page').style.display = 'block';
        });
    </script>
</body>
</html>
